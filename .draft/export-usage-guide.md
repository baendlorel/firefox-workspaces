# 导入导出功能使用指南

## 导出功能

### 导出无加密工作区

1. 点击插件主界面右上角的"更多操作"按钮（三个点）
2. 选择"导出数据"
3. 系统会自动生成 JSON 文件并下载
4. 文件名格式：`kskb-workspaces-YYYY-MM-DD_HH-MM-SS.json`

### 导出含加密工作区

1. 点击"更多操作" → "导出数据"
2. 系统检测到加密工作区后，会显示密码输入表单
3. 在表单中为每个加密工作区输入密码
   - 每个工作区下方会显示密码提示（前3位字符）
4. 点击"导出"按钮
5. 如果所有密码正确：
   - 文件自动下载
   - 页面在 1.5 秒后自动关闭
6. 如果有密码错误：
   - 错误的输入框会显示红色边框和阴影
   - 显示错误密码的数量
   - 页面保持打开状态
   - 修正密码后可再次点击"导出"

## 导入功能

1. 点击"更多操作" → "导入数据"
2. 在导入页面点击"选择文件"
3. 选择之前导出的 JSON 文件
4. 系统会自动验证并导入数据
5. 导入规则：
   - 工作区：只新增，不覆盖已有的工作区
   - 设置：完全覆盖现有设置
6. 导入完成后会显示通知，告知新增了多少个工作区

## 注意事项

### 密码保护

- 导出时，加密工作区必须输入正确的密码才能导出
- 导入的 JSON 文件中包含加密信息
- 建议妥善保管导出的 JSON 文件

### 文件格式

- 导出的是纯 JSON 格式，可读性强
- 不再使用压缩格式
- 不包含 hash 校验字段

### 数据安全

- 导出前会自动保存当前所有打开窗口的标签页状态
- 导入不会删除现有数据，只会新增
- 如需完全替换数据，请先手动删除现有工作区

## 故障排除

### 导出时密码一直提示错误

1. 确认密码区分大小写
2. 查看密码提示（前3位）确认是否记忆正确
3. 如果忘记密码，可以：
   - 在主界面编辑该工作区，修改密码
   - 或者单独导出不需要密码的工作区

### 导入失败

1. 确认 JSON 文件格式正确
2. 确认文件是本插件导出的
3. 检查浏览器控制台的错误信息
4. 如果是旧版本导出的文件，可能需要手动编辑 JSON 移除 hash 字段

## JSON 文件结构示例

```json
{
  "workspaces": [
    {
      "id": "kskb_1728000000_abc123",
      "name": "My Workspace",
      "color": "#2da191",
      "tabs": [...],
      "createdAt": 1728000000000,
      "lastOpened": 1728000000000,
      "password": "",
      "passpeek": "",
      "lockUntil": 0,
      "failedAttempts": 0
    }
  ],
  "settings": {...},
  "timestamp": 1728000000000
}
```

## 技术细节

- 密码使用 SHA-256 哈希存储
- 时间戳使用 Unix 毫秒时间戳
- 颜色使用 HEX 格式（#RRGGBB）
- 所有字符串使用 UTF-8 编码
