import { createDialog } from '../src/web/components/dialog/index.js';
import { h, div } from '@/lib/dom.js';
import { i } from '@/lib/ext-apis.js';

/**
 * About dialog component
 * Uses the project's dialog utilities and dom helpers to match style
 */
export default (): HTMLDialogElement => {
  const href = 'https://github.com/baendlorel/firefox-workspaces';

  const rawBody = [
    div('about-header', [
      h('div', 'about-logo', '🗂️'),
      h('h2', 'about-title', '__NAME__'),
      h('div', 'about-version', 'v__VERSION__'),
    ]),

    div('about-description', [
      h('p', 'about-tagline', i('extensionDescription')),
      h('p', 'about-subtitle', i('organizeTabs')),
    ]),

    div('about-features', [
      h('div', 'feature-item', [
        h('span', 'feature-icon', '🚀'),
        h('span', 'feature-text', i('lightningFast')),
      ]),
      h('div', 'feature-item', [
        h('span', 'feature-icon', '🎨'),
        h('span', 'feature-text', i('beautifulColorCoded')),
      ]),
      h('div', 'feature-item', [
        h('span', 'feature-icon', '💾'),
        h('span', 'feature-text', i('importExport')),
      ]),
      h('div', 'feature-item', [
        h('span', 'feature-icon', '⚡'),
        h('span', 'feature-text', i('createFromTabs')),
      ]),
    ]),

    div('about-links', [
      h('a', { href, class: 'about-link repo-link' }, [
        h('span', 'link-icon', '📁'),
        h('span', 'link-text', i('repository')),
      ]),
      h('a', { href: href + '/issues', class: 'about-link' }, [
        h('span', 'link-icon', '🐛'),
        h('span', 'link-text', i('reportIssues')),
      ]),
      h('a', { href: href + '/releases', class: 'about-link' }, [
        h('span', 'link-icon', '📋'),
        h('span', 'link-text', i('changelog')),
      ]),
    ]),

    div('about-footer', [
      h('p', 'about-copyright', '© __AUTHOR_NAME__ • Licensed under MIT'),
      h('p', 'about-contact', 'Contact: __AUTHOR_EMAIL__'),
    ]),
  ];

  const { dialog, body, closeBtn } = createDialog(i('aboutFirefoxWorkspaces'), rawBody);

  // Apply custom styles
  body.style.cssText = `
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  `;

  // Logo and header styles
  const logoEl = body.querySelector('.about-logo') as HTMLElement;
  if (logoEl) {
    logoEl.style.cssText = `
      font-size: 4rem;
      margin-bottom: 1rem;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    `;
  }

  const titleEl = body.querySelector('.about-title') as HTMLElement;
  if (titleEl) {
    titleEl.style.cssText = `
      font-size: 2.5rem;
      font-weight: bold;
      margin: 0.5rem 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    `;
  }

  const versionEl = body.querySelector('.about-version') as HTMLElement;
  if (versionEl) {
    versionEl.style.cssText = `
      font-size: 1.2rem;
      opacity: 0.9;
      background: rgba(255,255,255,0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      display: inline-block;
      margin-bottom: 1.5rem;
    `;
  }

  // Description styles
  const descriptionEl = body.querySelector('.about-description') as HTMLElement;
  if (descriptionEl) {
    descriptionEl.style.cssText = `
      margin: 2rem 0;
    `;
  }

  const taglineEl = body.querySelector('.about-tagline') as HTMLElement;
  if (taglineEl) {
    taglineEl.style.cssText = `
      font-size: 1.3rem;
      font-weight: 500;
      margin: 0.5rem 0;
    `;
  }

  const subtitleEl = body.querySelector('.about-subtitle') as HTMLElement;
  if (subtitleEl) {
    subtitleEl.style.cssText = `
      font-size: 1.1rem;
      opacity: 0.9;
      margin: 0.5rem 0;
    `;
  }

  // Features styles
  const featuresEl = body.querySelector('.about-features') as HTMLElement;
  if (featuresEl) {
    featuresEl.style.cssText = `
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 2rem 0;
      padding: 1.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      backdrop-filter: blur(10px);
    `;
  }

  body.querySelectorAll('.feature-item').forEach((item: Element) => {
    (item as HTMLElement).style.cssText = `
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: 8px;
      transition: background 0.2s ease;
    `;

    item.addEventListener('mouseenter', () => {
      (item as HTMLElement).style.background = 'rgba(255,255,255,0.1)';
    });

    item.addEventListener('mouseleave', () => {
      (item as HTMLElement).style.background = 'transparent';
    });
  });

  body.querySelectorAll('.feature-icon').forEach((icon: Element) => {
    (icon as HTMLElement).style.cssText = `
      font-size: 1.5rem;
      flex-shrink: 0;
    `;
  });

  body.querySelectorAll('.feature-text').forEach((text: Element) => {
    (text as HTMLElement).style.cssText = `
      font-size: 0.9rem;
      text-align: left;
    `;
  });

  // Links styles
  const linksEl = body.querySelector('.about-links') as HTMLElement;
  if (linksEl) {
    linksEl.style.cssText = `
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    `;
  }

  body.querySelectorAll('.about-link').forEach((link: Element) => {
    (link as HTMLElement).style.cssText = `
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: rgba(255,255,255,0.2);
      border-radius: 25px;
      text-decoration: none;
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    `;

    link.addEventListener('mouseenter', () => {
      (link as HTMLElement).style.cssText += `
        background: rgba(255,255,255,0.3);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      `;
    });

    link.addEventListener('mouseleave', () => {
      (link as HTMLElement).style.transform = 'translateY(0)';
      (link as HTMLElement).style.background = 'rgba(255,255,255,0.2)';
      (link as HTMLElement).style.boxShadow = 'none';
    });
  });

  // Footer styles
  const footerEl = body.querySelector('.about-footer') as HTMLElement;
  if (footerEl) {
    footerEl.style.cssText = `
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255,255,255,0.2);
      opacity: 0.8;
      font-size: 0.9rem;
    `;
  }

  body.querySelectorAll('.about-footer p').forEach((p: Element) => {
    (p as HTMLElement).style.margin = '0.25rem 0';
  });

  // Accessibility enhancements
  dialog.setAttribute('aria-label', i('aboutFirefoxWorkspaces') + ' - Application Information');
  closeBtn.title = i('closeAboutDialog');
  closeBtn.setAttribute('aria-label', i('closeAboutDialog'));

  document.body.appendChild(dialog);
  return dialog;
};
